# Example: Multi-Pool Configuration (Tengil's Setup)
version: 2
mode: converged-nas

pools:
  # NVMe pool - Fast storage for OS, VMs, databases
  rpool:
    type: zfs
    description: "Multi TB NVMe - System (OS) and fast storage"
    
    datasets:
      # Application configuration (small, fast access needed)
      appdata:
        profile: dev
        containers:
          - name: jellyfin
            mount: /config
          - name: nextcloud
            mount: /var/www/html
          - name: sonarr
            mount: /config
          - name: radarr
            mount: /config
      
      # Databases (need low latency)
      postgres:
        profile: dev
        zfs:
          recordsize: 8K
          logbias: latency
          primarycache: metadata
        containers:
          - name: postgres-nextcloud
            mount: /var/lib/postgresql/data
        permissions:
          uid: postgres
          gid: postgres
          mode: "0700"
      
      # VM storage
      vm-storage:
        profile: dev
        zfs:
          recordsize: 64K
          volblocksize: 16K
  
  # SATA RAID1 pool - Media and bulk storage
  tank:
    type: zfs
    description: "Multi TB usable (2x Multi TB SATA mirror) - Media storage"
    
    datasets:
      # Downloads - MUST be on same pool as media for hardlinks!
      downloads:
        profile: media
        zfs:
          recordsize: 1M
          compression: lz4
        containers:
          - name: qbittorrent
            mount: /downloads
          - name: sonarr
            mount: /downloads
          - name: radarr
            mount: /downloads
        permissions:
          uid: 1000
          gid: 1000
          mode: "0775"
      
      # TV shows
      tv:
        profile: media
        containers:
          - name: sonarr
            mount: /tv
          - name: jellyfin
            mount: /tv
            readonly: true
        shares:
          smb:
            name: "TV Shows"
            browseable: true
      
      # Movies
      movies:
        profile: media
        containers:
          - name: radarr
            mount: /movies
          - name: jellyfin
            mount: /movies
            readonly: true
        shares:
          smb:
            name: "Movies"
            browseable: true
      
      # Music
      audio:
        profile: audio
        zfs:
          recordsize: 1M
          compression: lz4
          atime: off
        containers:
          - name: navidrome
            mount: /music
            readonly: true
        shares:
          smb:
            name: "Music"
            browseable: true
      
      # Photos
      photos:
        profile: photos
        zfs:
          recordsize: 1M
          compression: lz4
          copies: 2  # Extra safety for photos
        containers:
          - name: immich
            mount: /photos
        shares:
          smb:
            name: "Photos"
            valid_users: "@family"
      
      # AI models and datasets
      ai:
        profile: ai-models
        zfs:
          recordsize: 128K
          compression: lz4
          atime: off
        
      ai/models:
        profile: ai-models
        zfs:
          recordsize: 1M  # Large model files
        containers:
          - name: ollama
            mount: /models
            readonly: true
      
      # Backups
      backups:
        profile: backups
        zfs:
          compression: zstd
          atime: off
        shares:
          nfs:
            allowed: "192.168.1.0/24"
            options: "rw,sync"
      
      # Games
      games:
        profile: gaming
        shares:
          smb:
            name: "Games"
            browseable: true
      
      # ROMs
      roms:
        profile: roms
        zfs:
          copies: 2  # Protect ROM collection
        shares:
          smb:
            name: "ROMs"
            read_only: true

# Notes:
# 1. Downloads, TV, Movies on SAME pool (tank) for hardlinks
# 2. App configs on fast NVMe (rpool) for speed
# 3. Databases on fast NVMe with optimized settings
# 4. Media on slow SATA with redundancy
