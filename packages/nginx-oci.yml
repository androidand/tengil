---
# Nginx OCI Container Package
# High-performance web server and reverse proxy
#
# Usage:
#   tg apply packages/nginx-oci.yml

name: nginx
type: oci
version: latest

oci:
  image: nginx
  tag: alpine
  registry: docker.io

# Container configuration
hostname: nginx
cores: 1
memory: 256
disk: 4

# Resource pool (optional)
# pool: network

# Network configuration
network:
  bridge: vmbr0
  ip: dhcp

# Security
unprivileged: true

# Features
features:
  nesting: false

# Mount configuration and web content
mounts:
  - source: /tank/config/nginx
    target: /etc/nginx/conf.d
    readonly: false
  - source: /tank/www
    target: /usr/share/nginx/html
    readonly: false

# Auto-created volumes (by OCI):
# - /etc/nginx (default config)
# - /usr/share/nginx/html (web root)

# Post-deployment:
# 1. Access default page: http://<container-ip>:80
# 2. Add custom nginx configs to /etc/nginx/conf.d/
# 3. Add website content to /usr/share/nginx/html/
# 4. Reload config: pct exec <vmid> -- nginx -s reload

# Verification:
# - Check default page loads
# - Test custom configs
# - Verify SSL/TLS if configured
# - Check logs: pct exec <vmid> -- tail -f /var/log/nginx/access.log

# Example reverse proxy config (/etc/nginx/conf.d/proxy.conf):
# server {
#     listen 80;
#     server_name app.example.com;
#
#     location / {
#         proxy_pass http://backend:8080;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#     }
# }

# Notes:
# - Alpine-based for minimal size
# - Extremely lightweight and fast
# - Use Traefik for automatic SSL and service discovery
# - Use Nginx for static sites and manual proxy configs
